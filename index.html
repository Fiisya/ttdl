<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TikTok Downloader</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f5f5f5;
      color: #fff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .container {
      background-color: #0056ff;
      padding: 30px;
      width: 100%;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }
    .logo {
      margin-bottom: 15px;
      font-size: 2rem;
      font-weight: 600;
      color: #fff;
    }
    h1 {
      font-size: 1.8rem;
      margin-bottom: 10px;
      font-weight: 600;
    }
    p {
      font-size: 1rem;
      margin-bottom: 20px;
      color: #f1f1f1;
    }
    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      max-width: 500px;
      width: 100%;
    }
    input {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      background-color: #fff;
      color: #333;
    }
    .paste-btn {
      padding: 12px 20px;
      background-color: #e0e7ff;
      border: none;
      border-radius: 8px;
      color: #0056ff;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s;
    }
    .paste-btn:hover {
      background-color: #d1d9ff;
    }
    .download-btn {
      width: 100%;
      max-width: 500px;
      padding: 15px;
      background-color: #00c853;
      border: none;
      border-radius: 8px;
      color: #fff;
      font-weight: 600;
      font-size: 1.1rem;
      cursor: pointer;
      transition: background 0.3s;
    }
    .download-btn:hover {
      background-color: #00b046;
    }
    #loading {
      font-size: 1rem;
      margin-top: 10px;
      animation: blink 1s infinite;
    }
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    #result {
      margin-top: 20px;
      max-width: 500px;
      width: 100%;
    }
    video {
      width: 100%;
      margin-top: 10px;
      border-radius: 10px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.3);
    }
    .description, .qna {
      max-width: 500px;
      width: 100%;
      margin-top: 40px;
      text-align: left;
    }
    .description h2, .qna h2 {
      font-size: 1.5rem;
      margin-bottom: 15px;
      color: #fff;
    }
    .description p {
      font-size: 0.9rem;
      line-height: 1.6;
    }
    .qna .question {
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 1rem;
    }
    .qna .answer {
      font-size: 0.9rem;
      margin-bottom: 20px;
      color: #f1f1f1;
      line-height: 1.6;
    }
    footer {
      text-align: center;
      padding: 20px;
      font-size: 14px;
      color: #999;
      background-color: #f5f5f5;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">SnapTik</div>
    <h1>Download video TikTok</h1>
    <p>Tiktok Downloader Tanpa Watermark. Cepat. Semua perangkat</p>
    <div class="input-group">
      <input type="text" id="urlInput" placeholder="Tempel tautan TikTok di sini" />
      <button class="paste-btn" onclick="pasteLink()">Tempel</button>
    </div>
    <button class="download-btn" onclick="download()">Download</button>

    <div id="loading" style="display:none;">Loading...</div>
    <div id="result"></div>

    <div class="description">
      <h2>Tentang SnapTik</h2>
      <p>SnapTik adalah alat gratis untuk mengunduh video TikTok tanpa watermark. Dengan antarmuka yang sederhana dan cepat, Anda dapat menyimpan video favorit Anda langsung ke perangkat dalam beberapa klik. Kami mendukung semua perangkat, termasuk ponsel, tablet, dan komputer, tanpa perlu menginstal aplikasi tambahan.</p>
    </div>

    <div class="qna">
      <h2>Pertanyaan Umum (Q&A)</h2>
      <div class="question">Apa itu SnapTik?</div>
      <div class="answer">SnapTik adalah layanan online yang memungkinkan Anda mengunduh video TikTok tanpa watermark dengan cepat dan mudah.</div>

      <div class="question">Apakah SnapTik gratis?</div>
      <div class="answer">Ya, SnapTik sepenuhnya gratis untuk digunakan. Tidak ada biaya tersembunyi atau langganan yang diperlukan.</div>

      <div class="question">Bagaimana cara menggunakan SnapTik?</div>
      <div class="answer">Cukup salin tautan video TikTok, tempelkan di kolom yang tersedia, lalu klik tombol "Download". Video akan diunduh tanpa watermark.</div>
    </div>
  </div>

  <footer>
    © 2025 AlfixD. All rights reserved.
  </footer>

  </div>

  <script>
    // Fungsi pembantu untuk memaksa download file
async function forceDownload(url, fileName) {
  // Tampilkan pesan bahwa proses download sedang berlangsung
  const result = document.getElementById("result");
  result.innerHTML = `<p>Sedang mempersiapkan unduhan untuk: <strong>${fileName}</strong>...</p>`;
  
  try {
    // 1. Ambil data file sebagai 'blob'
    const response = await fetch(url);
    const blob = await response.blob();

    // 2. Buat URL sementara untuk blob
    const objectUrl = URL.createObjectURL(blob);

    // 3. Buat link (<a>) virtual
    const a = document.createElement("a");
    a.href = objectUrl;
    a.download = fileName; // Tentukan nama file
    document.body.appendChild(a); // Tambahkan ke dokumen agar bisa di-klik

    // 4. Klik link virtual untuk memulai download
    a.click();

    // 5. Hapus link dan URL sementara setelah selesai
    a.remove();
    URL.revokeObjectURL(objectUrl);
    
    // Tampilkan pesan sukses
    result.innerHTML = `<p style="color:green;">✅ Unduhan <strong>${fileName}</strong> telah dimulai!</p>`;
    
  } catch (err) {
    // Tampilkan pesan jika fetch atau prosesnya gagal
    result.innerHTML = `<p style="color:red;">Gagal mengunduh file: ${err.message}</p>`;
    console.error("Download error:", err);
  }
}


// (Fungsi ini tidak perlu diubah)
async function pasteLink() {
  try {
    const text = await navigator.clipboard.readText();
    document.getElementById("urlInput").value = text;
  } catch (err) {
    alert("Gagal mengakses clipboard: " + err.message);
  }
}


// (Fungsi ini tidak perlu diubah)
async function tiktokDownloaderVideo(url) {
  return new Promise(async (resolve, reject) => {
    try {
      let data = [];

      function formatDate(n, locale = "id-ID") {
        let d = new Date(n * 1000);
        return d.toLocaleString(locale, {
          weekday: "long",
          day: "numeric",
          month: "long",
          year: "numeric",
          hour: "numeric",
          minute: "numeric",
        });
      }

      let domain = "https://www.tikwm.com/api/";
      let res = (await axios.post(domain, {}, {
        headers: {
          "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",
          Referer: "https://www.tikwm.com/",
          "User-Agent": "Mozilla/5.0 (Linux; Android 10)",
        },
        params: {
          url,
          count: 12,
          cursor: 0,
          web: 1,
          hd: 1,
        },
      })).data.data;

      if (!res.size && res.images) {
        res.images.forEach((v) => {
          data.push({
            type: "photo",
            url: v
          });
        });
      } else {
        data.push({
          type: "watermark",
          url: "https://www.tikwm.com" + res.wmplay,
        }, {
          type: "nowatermark",
          url: "https://www.tikwm.com" + res.play,
        }, {
          type: "nowatermark_hd",
          url: "https://www.tikwm.com" + res.hdplay,
        });
      }

      resolve({
        status: true,
        title: res.title,
        taken_at: formatDate(res.create_time),
        region: res.region,
        id: res.id,
        duration: res.duration + " detik",
        cover: "https://www.tikwm.com" + res.cover,
        music_info: {
          title: res.music_info.title,
          author: res.music_info.author,
          url: "https://www.tikwm.com" + (res.music || res.music_info.play),
        },
        data,
        author: {
          nickname: res.author.nickname,
        },
      });
    } catch (e) {
      reject(e);
    }
  });
}

// =========================================================
// INI FUNGSI UTAMA YANG DIUBAH
// =========================================================
async function download() {
  const url = document.getElementById("urlInput").value;
  const loading = document.getElementById("loading");
  const result = document.getElementById("result");
  result.innerHTML = "";
  if (!url) return alert("Masukkan URL TikTok!");

  loading.style.display = "block";

  try {
    const data = await tiktokDownloaderVideo(url);
    
    // Cek apakah postingan ini video atau foto slide
    const isPhotoPost = data.data.some(media => media.type === 'photo');

    if (isPhotoPost) {
      // Jika ini adalah postingan foto, unduh semua gambar
      loading.style.display = "none";
      result.innerHTML = `<p>Postingan berisi ${data.data.length} gambar. Mengunduh semua...</p>`;
      
      for (let i = 0; i < data.data.length; i++) {
        const media = data.data[i];
        const fileName = `${data.title || 'tiktok_image'}_${i + 1}.jpeg`;
        // Menunggu setiap unduhan selesai sebelum memulai yang berikutnya
        await forceDownload(media.url, fileName);
      }
      result.innerHTML += `<p style="color:green;">✅ Semua gambar berhasil diunduh!</p>`;

    } else {
      // Jika ini video, cari versi terbaik
      const videoToDownload = data.data.find(media => media.type === 'nowatermark_hd') || data.data.find(media => media.type === 'nowatermark');

      if (videoToDownload) {
        // Buat nama file yang lebih baik
        const fileName = `${data.author.nickname} - ${data.title || data.id}.mp4`;
        
        // Mulai download menggunakan fungsi pembantu
        await forceDownload(videoToDownload.url, fileName);
      } else {
        throw new Error("Tidak ditemukan link video tanpa watermark.");
      }
    }
    
  } catch (err) {
    result.innerHTML = `<p style="color:red;">Terjadi kesalahan: ${err.message}</p>`;
  } finally {
    // Selalu sembunyikan loading di akhir, baik berhasil maupun gagal
    loading.style.display = "none";
  }
}
  </script>
</body>
</html>
